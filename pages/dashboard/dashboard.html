<!DOCTYPE html>
<html lang="vi" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Hệ thống quản lý nhân sự chuyên nghiệp">
    <meta name="theme-color" content="#2563eb">
    <link rel="icon" href="../../assets/icons/favicon-32x32.png" sizes="32x32">
    <title>HR Management System - Dashboard</title>
    
    <!-- Modular CSS Files -->
    <link rel="stylesheet" href="../../assets/css/base.css">
    <link rel="stylesheet" href="../../assets/css/components.css">
    <link rel="stylesheet" href="../../assets/css/navigation.css">
    <link rel="stylesheet" href="../../assets/css/modals.css">
    <link rel="stylesheet" href="../../assets/css/containers.css">
    <link rel="stylesheet" href="../../assets/css/dash.css">
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

</head>
<body>
    <!-- Dashboard Loading Screen -->
    <div id="dashboardLoader" class="dashboard-loader">
        <div class="loader-content">
            <div class="dual-spinner-container">
                <div class="spinner-outer"></div>
                <div class="spinner-inner"></div>
            </div>
            <h3 class="loader-title">Đang tải Dashboard...</h3>
            <p class="loader-subtitle">Vui lòng đợi trong giây lát</p>
            <div class="loader-progress">
                <div class="progress-bar"></div>
            </div>
        </div>
        <div class="loader-background">
            <div class="floating-particles">
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard Content (initially hidden) -->
    <div id="dashboardContent" class="dashboard-content">

    <!-- Mobile Navigation Dialog - GitHub Style -->
    <dialog id="mobile-nav-dialog" class="mobile-nav-dialog">
        <div class="mobile-nav-content">
            <div class="mobile-nav-header">
                <h2>Menu</h2>
                <button type="button" class="close-dialog" aria-label="Close navigation">
                    <span class="material-icons-round">close</span>
                </button>
            </div>
            <nav class="mobile-nav">
                <ul id="mobileMenuList" class="mobile-menu-list">
                    <li class="mobile-menu-item" data-role="AD,QL,NV">
                        <a href="#" id="mobileWorkManagement" class="mobile-menu-link">
                            <span class="material-icons-round">schedule</span>
                            Quản Lý Công
                        </a>
                        <ul class="mobile-submenu">
                            <li class="mobile-submenu-item" data-role="AD,AM,QL,NV">
                                <a href="#" id="mobileTimesheet" class="mobile-submenu-link">
                                    <span class="material-icons-round">calendar_view_month</span>
                                    Bảng Công
                                </a>
                            </li>
                            <li class="mobile-submenu-item" data-role="AD,AM,QL,NV">
                                <a href="#" id="mobileAttendance" class="mobile-submenu-link">
                                    <span class="material-icons-round">location_on</span>
                                    Chấm Công
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="mobile-menu-item" data-role="AD,AM,QL,NV">
                        <a href="#" id="mobileWorkTasks" class="mobile-menu-link">Công Việc</a>
                    </li>
                    <li class="mobile-menu-item" data-role="AD,NV">
                        <a href="#" id="mobileSubmitRequest" class="mobile-menu-link">
                            <span class="material-icons-round">send</span>
                            Gửi Yêu Cầu
                        </a>
                        <ul class="mobile-submenu">
                            <li class="mobile-submenu-item" data-role="AD,NV">
                                <a href="#" id="mobileAttendanceRequest" class="mobile-submenu-link">
                                    <span class="material-icons-round">assignment</span>
                                    Đơn Từ
                                </a>
                            </li>
                            <li class="mobile-submenu-item" data-role="AD,NV">
                                <a href="#" id="mobileTaskAssignment" class="mobile-submenu-link">
                                    <span class="material-icons-round">task_alt</span>
                                    Nhiệm Vụ
                                </a>
                            </li>
                            <li class="mobile-submenu-item" data-role="AD,AM,QL">
                                <a href="#" id="mobileShiftAssignment" class="mobile-submenu-link">
                                    <span class="material-icons-round">schedule_send</span>
                                    Phân Ca
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="mobile-menu-item" data-role="AD,QL">
                        <a href="#" id="mobileTaskProcessing" class="mobile-menu-link">Xử Lý Yêu Cầu</a>
                        <ul class="mobile-submenu">
                            <li class="mobile-submenu-item" data-role="AD">
                                <a href="#" id="mobileTaskPersonnel" class="mobile-submenu-link">Nhân Sự</a>
                            </li>
                            <li class="mobile-submenu-item" data-role="AD,QL">
                                <a href="#" id="mobileTaskStore" class="mobile-submenu-link">Cửa Hàng</a>
                            </li>
                            <li class="mobile-submenu-item" data-role="AD">
                                <a href="#" id="mobileTaskFinance" class="mobile-submenu-link">Tài Chính</a>
                            </li>
                            <li class="mobile-submenu-item" data-role="AD,QL">
                                <a href="#" id="mobileTaskApproval" class="mobile-submenu-link">Xét Duyệt</a>
                            </li>
                        </ul>
                    </li>
                    <li class="mobile-menu-item" data-role="AD,QL">
                        <a href="#" id="mobileRegistrationApproval" class="mobile-menu-link">Duyệt Đăng Ký</a>
                    </li>
                    <li class="mobile-menu-item" data-role="AD">
                        <a href="#" id="mobileGrantAccess" class="mobile-menu-link">Phân Quyền</a>
                    </li>
                    <li class="mobile-menu-item" data-role="AD,QL,AM,NV">
                        <a href="#" id="mobilePersonalInformation" class="mobile-menu-link">Thông Tin Cá Nhân</a>
                    </li>
                </ul>
                <div class="mobile-nav-footer">
                    <button id="mobileLogout" class="mobile-logout-btn">
                        <span class="material-icons-round">logout</span>
                        Đăng xuất
                    </button>
                </div>
            </nav>
        </div>
    </dialog>

    <!-- Mobile Sidebar Overlay -->
    <div id="sidebarOverlay" class="sidebar-overlay"></div>

    <!-- Mobile Menu Toggle - positioned independently -->
    <button id="menuToggle" class="menu-toggle" aria-label="Toggle navigation" data-target="mobile-nav-dialog">
        <span class="menu-icon">
            <span class="menu-line"></span>
            <span class="menu-line"></span>
            <span class="menu-line"></span>
        </span>
    </button>

    <!-- User Info Header - GitHub AppHeader Style -->
    <div class="show-user AppHeader-globalBar pb-2 js-global-bar">
        <div class="AppHeader-context">
            <div class="company-logo">
                <h1><a href="#" id="companyLogoLink" class="AppHeader-logo" style="text-decoration: none; color: inherit; cursor: pointer;">
                    <span class="company-name-desktop">ZewK Management System</span>
                    <span class="company-name-mobile">ZewK</span>
                </a></h1>
            </div>
        </div>
        <div class="AppHeader-actions">
            <div class="AppHeader-user">
                <div id="userInfo" class="user-info"></div>
                <div id="currentTime" class="current-time">
                    <span id="timeIcon" class="time-icon material-icons-round">wb_sunny</span>
                    <span id="timeDisplay" class="time-display">00:00</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
        <ul id="menuList" class="menu-list">
            <li class="menu-item" data-role="AD,QL,NV">
                <a href="#" id="openWorkManagement" class="menu-link">
                    <span class="material-icons-round">schedule</span>
                    Quản Lý Công
                </a>
                <ul class="submenu">
                    <li class="submenu-item" data-role="AD,AM,QL,NV">
                        <a href="#" id="openTimesheet" class="submenu-link">
                            <span class="material-icons-round">calendar_view_month</span>
                            Bảng Công
                        </a>
                    </li>
                    <li class="submenu-item" data-role="AD,AM,QL,NV">
                        <a href="#" id="openAttendance" class="submenu-link">
                            <span class="material-icons-round">location_on</span>
                            Chấm Công
                        </a>
                    </li>
                </ul>
            </li>
            <li class="menu-item" data-role="AD,AM,QL,NV">
                <a href="#" id="openWorkTasks" class="menu-link">
                    <span class="material-icons-round">work</span>
                    Công Việc
                </a>
            </li>
            <li class="menu-item" data-role="AD,NV">
                <a href="#" id="openSubmitRequest" class="menu-link">
                    <span class="material-icons-round">send</span>
                    Gửi Yêu Cầu
                </a>
                <ul class="submenu">
                    <li class="submenu-item" data-role="AD,NV">
                        <a href="#" id="openAttendanceRequest" class="submenu-link">
                            <span class="material-icons-round">assignment</span>
                            Đơn Từ
                        </a>
                    </li>
                    <li class="submenu-item" data-role="AD,NV">
                        <a href="#" id="openTaskAssignment" class="submenu-link">
                            <span class="material-icons-round">task_alt</span>
                            Nhiệm Vụ
                        </a>
                    </li>
                    <li class="submenu-item" data-role="AD,AM,QL">
                        <a href="#" id="openShiftAssignment" class="submenu-link">
                            <span class="material-icons-round">schedule_send</span>
                            Phân Ca
                        </a>
                    </li>
                </ul>
            </li>
            <li class="menu-item" data-role="AD,QL,AM">
                <a href="#" id="openTaskProcessing" class="menu-link">Xử Lý Yêu Cầu</a>
                <ul class="submenu">
                    <li class="submenu-item" data-role="AD,QL">
                        <a href="#" id="taskPersonnel" class="submenu-link">Nhân Sự</a>
                    </li>
                    <li class="submenu-item" data-role="AD,AM">
                        <a href="#" id="taskStore" class="submenu-link">Cửa Hàng</a>
                    </li>
                    <li class="submenu-item" data-role="AD">
                        <a href="#" id="taskFinance" class="submenu-link">Tài Chính</a>
                    </li>
                    <li class="submenu-item" data-role="AD,QL">
                        <a href="#" id="taskApproval" class="submenu-link">Xét Duyệt</a>
                    </li>
                </ul>
            </li>
            <li class="menu-item" data-role="AD,QL">
                <a href="#" id="openRegistrationApproval" class="menu-link">Duyệt Đăng Ký</a>
            </li>
            <li class="menu-item" data-role="AD">
                <a href="#" id="openGrantAccess" class="menu-link">Phân Quyền</a>
            </li>
            <li class="menu-item" data-role="AD,QL,AM,NV">
                <a href="#" id="openPersonalInformation" class="menu-link">Thông Tin Cá Nhân</a>
            </li>
        </ul>
        <button id="logout" class="logout-btn">Đăng xuất</button>
    </div>

    <!-- Enhanced Loading Screen -->
    <div id="loadingScreen" class="loading-screen hidden">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2 class="loading-text">Đang tải hệ thống HR</h2>
            <p style="color: var(--text-secondary); font-size: 0.95rem; margin-bottom: 0;">Vui lòng chờ trong giây lát</p>
            <div class="loading-dots">
                <span class="loading-dot"></span>
                <span class="loading-dot"></span>
                <span class="loading-dot"></span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main dashboard-main-fade-in">
        <div id="notification" class="notification hidden"></div>
        <div id="content" class="content">
            <h1 class="dashboard-title">Hệ Thống Quản Lý Nhân Sự</h1>
            
            <!-- Enhanced Dashboard Overview -->
            <div class="welcome-section">
                <!-- Main Statistics Grid -->
                <div class="stats-grid">
                    <div class="stat-card primary">
                        <div class="stat-icon">👥</div>
                        <div class="stat-info">
                            <h3>Tổng Nhân Viên</h3>
                            <p id="totalEmployees">-</p>
                            <span class="stat-trend">+2 tuần này</span>
                        </div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-icon">📅</div>
                        <div class="stat-info">
                            <h3>Ca Hôm Nay</h3>
                            <p id="todayShift">-</p>
                            <span class="stat-trend" id="todayShiftTime">-</span>
                        </div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-icon">📋</div>
                        <div class="stat-info">
                            <h3>Yêu Cầu Chờ</h3>
                            <p id="pendingRequests">-</p>
                            <span class="stat-trend">Cần xử lý</span>
                        </div>
                    </div>
                    <div class="stat-card info">
                        <div class="stat-icon">💬</div>
                        <div class="stat-info">
                            <h3>Tin Nhắn Mới</h3>
                            <p id="recentMessages">-</p>
                            <span class="stat-trend">24h qua</span>
                        </div>
                    </div>
                </div>

                <!-- Role-based Quick Actions -->
                <div class="quick-actions-section">
                    <h2 class="section-title">Thao Tác Nhanh</h2>
                    <div class="quick-actions-grid">
                        <button class="quick-action-btn" data-action="addEmployee">
                            <span class="action-icon">👤</span>
                            <span class="action-text">Thêm Nhân Viên</span>
                        </button>
                        <button class="quick-action-btn" data-action="assignShift">
                            <span class="action-icon">📊</span>
                            <span class="action-text">Phân Ca</span>
                        </button>
                        <button class="quick-action-btn" data-action="manageRewards">
                            <span class="action-icon">🏆</span>
                            <span class="action-text">Quản Lý Thưởng</span>
                        </button>
                        <button class="quick-action-btn" data-action="viewReports">
                            <span class="action-icon">📈</span>
                            <span class="action-text">Báo Cáo</span>
                        </button>
                    </div>
                </div>

                <!-- Advanced Analytics Dashboard for Admin -->
                <div class="analytics-section">
                    <h2 class="section-title">Phân Tích Dữ Liệu</h2>
                    <div class="analytics-grid">
                        <div class="chart-card">
                            <h3>Hiệu Suất Nhân Viên</h3>
                            <div class="chart-placeholder" id="performanceChart">
                                <p>Đang tải biểu đồ...</p>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3>Lịch Làm Theo Tuần</h3>
                            <div class="chart-placeholder" id="scheduleChart">
                                <p>Đang tải biểu đồ...</p>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3>Thưởng/Phạt</h3>
                            <div class="chart-placeholder" id="rewardsChart">
                                <p>Đang tải biểu đồ...</p>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3>Doanh Thu</h3>
                            <div class="chart-placeholder" id="revenueChart">
                                <p>Đang tải biểu đồ...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Store Management for Managers -->
                <div class="store-management-section">
                    <h2 class="section-title">Quản Lý Cửa Hàng</h2>
                    <div class="store-grid">
                        <div class="store-card" data-store="ST001">
                            <div class="store-header">
                                <h3>Cửa Hàng Trung Tâm</h3>
                                <span class="store-status active">Hoạt động</span>
                            </div>
                            <div class="store-stats">
                                <div class="store-stat">
                                    <span class="stat-label">Nhân viên:</span>
                                    <span class="stat-value" id="store1Employees">-</span>
                                </div>
                                <div class="store-stat">
                                    <span class="stat-label">Ca làm hôm nay:</span>
                                    <span class="stat-value" id="store1Shift">-</span>
                                </div>
                            </div>
                            <div class="store-actions">
                                <button class="btn-sm btn-primary" onclick="manageStore('ST001')">Quản Lý</button>
                                <button class="btn-sm btn-outline" onclick="viewStoreShifts('ST001')">Xem Ca</button>
                            </div>
                        </div>
                        <div class="store-card" data-store="ST002">
                            <div class="store-header">
                                <h3>Cửa Hàng Quận 1</h3>
                                <span class="store-status active">Hoạt động</span>
                            </div>
                            <div class="store-stats">
                                <div class="store-stat">
                                    <span class="stat-label">Nhân viên:</span>
                                    <span class="stat-value" id="store2Employees">-</span>
                                </div>
                                <div class="store-stat">
                                    <span class="stat-label">Ca làm hôm nay:</span>
                                    <span class="stat-value" id="store2Shift">-</span>
                                </div>
                            </div>
                            <div class="store-actions">
                                <button class="btn-sm btn-primary" onclick="manageStore('ST002')">Quản Lý</button>
                                <button class="btn-sm btn-outline" onclick="viewStoreShifts('ST002')">Xem Ca</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activities -->
                <div class="activities-section">
                    <h2 class="section-title">Hoạt Động Gần Đây</h2>
                    <div class="activities-container">
                        <div id="recentActivities" class="activities-list">
                            <p class="loading-text">Đang tải hoạt động...</p>
                        </div>
                        <div class="activities-footer">
                            <button class="btn-outline" onclick="loadMoreActivities()">Xem thêm</button>
                        </div>
                    </div>
                </div>

                <!-- Finance Overview for Admin -->
                <div class="finance-section">
                    <h2 class="section-title">Tổng Quan Tài Chính</h2>
                    <div class="finance-grid">
                        <div class="finance-card revenue">
                            <div class="finance-header">
                                <h3>Doanh Thu Tháng</h3>
                                <span class="finance-trend up">↗ +12%</span>
                            </div>
                            <div class="finance-amount" id="monthlyRevenue">0 ₫</div>
                            <div class="finance-subtitle">So với tháng trước</div>
                        </div>
                        <div class="finance-card expense">
                            <div class="finance-header">
                                <h3>Chi Phí Tháng</h3>
                                <span class="finance-trend down">↘ -5%</span>
                            </div>
                            <div class="finance-amount" id="monthlyExpense">0 ₫</div>
                            <div class="finance-subtitle">Tiết kiệm được</div>
                        </div>
                        <div class="finance-card profit">
                            <div class="finance-header">
                                <h3>Lợi Nhuận</h3>
                                <span class="finance-trend up">↗ +18%</span>
                            </div>
                            <div class="finance-amount" id="monthlyProfit">0 ₫</div>
                            <div class="finance-subtitle">Tăng trưởng tốt</div>
                        </div>
                        <div class="finance-card payroll">
                            <div class="finance-header">
                                <h3>Lương Nhân Viên</h3>
                                <span class="finance-trend neutral">→ 0%</span>
                            </div>
                            <div class="finance-amount" id="monthlyPayroll">0 ₫</div>
                            <div class="finance-subtitle">Ổn định</div>
                        </div>
                    </div>
                </div>

                <!-- Registration Approval for Admin and Managers -->
                <div class="registration-approval-section">
                    <h2 class="section-title">Duyệt Đăng Ký Nhân Viên</h2>
                    <div class="approval-container">
                        <div class="approval-header">
                            <div class="approval-filters">
                                <select id="storeFilter" class="filter-select">
                                    <option value="">Tất cả cửa hàng</option>
                                </select>
                                <button id="refreshPendingBtn" class="refresh-btn">
                                    <span class="material-icons-round">refresh</span>
                                    Làm mới
                                </button>
                            </div>
                        </div>
                        <div id="pendingRegistrationsList" class="registrations-list">
                            <p class="loading-text">Đang tải danh sách...</p>
                        </div>
                    </div>
                </div>

                <!-- Personal Dashboard for Employees -->
                <div class="personal-section">
                    <h2 class="section-title">Thông Tin Cá Nhân</h2>
                    <div class="personal-grid">
                        <div class="personal-card schedule">
                            <h3>Ca Làm Tuần Này</h3>
                            <div id="personalShifts" class="shift-preview">
                                <p>Đang tải ca làm...</p>
                            </div>
                        </div>
                        <div class="personal-card rewards">
                            <h3>Thưởng/Phạt Gần Đây</h3>
                            <div id="personalRewards" class="rewards-preview">
                                <p>Đang tải thông tin...</p>
                            </div>
                        </div>
                        <div class="personal-card tasks">
                            <h3>Yêu Cầu Của Tôi</h3>
                            <div id="personalTasks" class="tasks-preview">
                                <p>Đang tải yêu cầu...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>


    <!-- Load JavaScript modules in correct order -->
    <script src="../../assets/js/config.js"></script>
    <script src="../../assets/js/utils.js"></script>
    <script src="../../assets/js/api-cache.js"></script>
    <script src="../../assets/js/auth-manager.js"></script>
    <script src="../../assets/js/theme-manager.js"></script>
    <script src="../../assets/js/menu-manager.js"></script>
    <script src="../../assets/js/navigation-manager.js"></script>
    <script src="../../assets/js/content-manager.js"></script>
    <script src="../../assets/js/dashboard-handler.js"></script>
    <script src="../../assets/js/script.js"></script>
    <script src="../../assets/js/main-init.js"></script>
    </div> <!-- End dashboardContent -->
</body>
</html>
